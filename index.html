<!DOCTYPE html>
<html>

<head>
    <title>Image Viewer</title>
    <script>
        document.cookie = "CloudFront-Signature=Kwy43skitQ9eO872FVb55A4NVu~n5gsQMbGWw6SSaWJ~DLWeSm2OjPGm-8dLEf5y9rTSphjIOfoEyeUeRh0RJzM-zpiuJV8Dwl~bNbsKAwBRP9qv0Du1zWyTu07HvFIFjp-QxqH8NBsRFCntyXItbltg~9NFMNWYx0t4IqQSjIZZqsPbBQ7clcoa~jHJxnw-tEzgNKpF0vr7ueMLE3XqEqJ8u31VHnXcKQDj~Vf3eJp362LHnuUgkSaIsNgVnI-lCf5ofqPr1cmqsV-0NssHy~vyDRzF9ivMo4POIatToXiOGtRWENqt07aUbejxR3T9LKyZgN4d3~-BMY4-EZ9CyA__; Path=/; Secure; SameSite=None";
        document.cookie = "CloudFront-Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6Ly9jb250ZW50LmdlbjIuYWkvKiIsIkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTY5NjYzNDA4OH19fV19; Path=/; Secure; SameSite=None";
        document.cookie = "CloudFront-Key-Pair-Id=KRCVY93K4RJDS; Path=/; Secure; SameSite=None";
    </script>
</head>

<body>
    <h1>Image Viewer</h1>

    <h2>Images:</h2>
    <div id="content">

    </div>
    <script>
        async function loadImageWithCookies(url, imgElement) {
            // cookies = document.cookie.split(";")

            // let cookie_map = {}


            // for(var i=0; i<cookies.length; i++) {
            // name = cookies[i].split('=')[0].trim();
            // value = cookies[i].split('=')[1].trim();
            // cookie_map[name] = value
            // }
            // url = `${url}?Policy=${cookie_map['CloudFront-Policy']}&Signature=${cookie_map['CloudFront-Signature']}&Key-Pair-Id=${cookie_map['CloudFront-Key-Pair-Id']}`
            try {
                let imgElem = document.createElement('img');

                // Fetch the image with cookies included in the request
                let res = await fetch(url, { credentials: "include", mode: 'cors' });

                // Check if the response status is OK (200)
                if (res.status === 200) {
                    imgElem.src = URL.createObjectURL(await res.blob());

                    let contentDiv = document.getElementById('content');
                    contentDiv.appendChild(imgElem);
                    contentDiv.appendChild(document.createElement('br'));
                } else {
                    console.error('Failed to load image:', res.status, res.statusText);
                }
            } catch (error) {
                console.error('Error loading image:', error);
            }
        }

        loadImageWithCookies('https://content.gen2.ai/local/org_id/test2.png');
        loadImageWithCookies('https://content.gen2.ai/local/org_id/test.png');
        loadImageWithCookies('https://content.gen2.ai/local/org_id/project_id/test.png');
    </script>
</body>

</html>
